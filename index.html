<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio/Video to Text Converter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        .upload-area:hover {
            border-color: #007bff;
        }
        .upload-area.dragover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        input[type="file"] {
            display: none;
        }
        .upload-btn {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .upload-btn:hover {
            background: #0056b3;
        }
        .media-player {
            margin: 20px 0;
            text-align: center;
        }
        audio, video {
            max-width: 100%;
            border-radius: 5px;
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        .transcribe-btn {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            margin: 0 10px;
        }
        .transcribe-btn:hover {
            background: #1e7e34;
        }
        .transcribe-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .stop-btn {
            background: #dc3545;
        }
        .stop-btn:hover {
            background: #c82333;
        }
        .status {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.listening {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .transcript {
            margin-top: 20px;
        }
        .transcript-output {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }
        .copy-btn {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 10px;
        }
        .copy-btn:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Audio/Video to Text Converter</h1>
        
        <div class="instructions">
            <strong>How it works:</strong> Upload your audio/video file, play it through your speakers, then click "Start Transcribing" to capture the audio through your microphone. Make sure your microphone can pick up the audio from your speakers for best results.
        </div>

        <div class="upload-area" id="uploadArea">
            <p>Drag & drop your audio/video file here or</p>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                Choose File
            </button>
            <input type="file" id="fileInput" accept="audio/*,video/*">
        </div>

        <div class="media-player" id="mediaPlayer" style="display: none;">
            <div id="mediaContainer"></div>
        </div>

        <div class="controls">
            <button class="transcribe-btn" id="startBtn" onclick="startTranscription()" disabled>
                üé§ Start Transcribing
            </button>
            <button class="transcribe-btn stop-btn" id="stopBtn" onclick="stopTranscription()" disabled>
                ‚èπÔ∏è Stop Transcribing
            </button>
        </div>

        <div class="status" id="status" style="display: none;"></div>

        <div class="transcript">
            <label for="transcriptOutput"><strong>Transcript:</strong></label>
            <textarea id="transcriptOutput" class="transcript-output" placeholder="Transcribed text will appear here..."></textarea>
            <button class="copy-btn" onclick="copyTranscript()">Copy Text</button>
        </div>
    </div>

    <script>
        let mediaElement = null;
        let recognition = null;
        let isTranscribing = false;

        // Check for Web Speech API support
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            document.getElementById('status').style.display = 'block';
            document.getElementById('status').className = 'status error';
            document.getElementById('status').textContent = 'Speech recognition not supported in this browser. Please use Chrome, Edge, or Safari.';
        }

        // File upload handling
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const mediaPlayer = document.getElementById('mediaPlayer');
        const mediaContainer = document.getElementById('mediaContainer');
        const startBtn = document.getElementById('startBtn');

        fileInput.addEventListener('change', handleFileSelect);

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            const url = URL.createObjectURL(file);
            const isVideo = file.type.startsWith('video/');
            
            mediaContainer.innerHTML = '';
            
            if (isVideo) {
                mediaElement = document.createElement('video');
                mediaElement.controls = true;
                mediaElement.width = 600;
            } else {
                mediaElement = document.createElement('audio');
                mediaElement.controls = true;
            }
            
            mediaElement.src = url;
            mediaContainer.appendChild(mediaElement);
            mediaPlayer.style.display = 'block';
            startBtn.disabled = false;

            // Clean up previous URL
            mediaElement.addEventListener('loadstart', () => {
                URL.revokeObjectURL(url);
            });
        }

        function startTranscription() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showStatus('Speech recognition not supported', 'error');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            let finalTranscript = '';
            const transcriptOutput = document.getElementById('transcriptOutput');

            recognition.onstart = () => {
                isTranscribing = true;
                startBtn.disabled = true;
                document.getElementById('stopBtn').disabled = false;
                showStatus('Listening... Make sure your microphone can hear the audio from your speakers.', 'listening');
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                transcriptOutput.value = finalTranscript + interimTranscript;
            };

            recognition.onerror = (event) => {
                showStatus(`Error: ${event.error}`, 'error');
                stopTranscription();
            };

            recognition.onend = () => {
                if (isTranscribing) {
                    // Restart if still transcribing
                    recognition.start();
                }
            };

            try {
                recognition.start();
            } catch (error) {
                showStatus('Failed to start speech recognition', 'error');
            }
        }

        function stopTranscription() {
            isTranscribing = false;
            if (recognition) {
                recognition.stop();
            }
            startBtn.disabled = false;
            document.getElementById('stopBtn').disabled = true;
            hideStatus();
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }

        function copyTranscript() {
            const transcriptOutput = document.getElementById('transcriptOutput');
            transcriptOutput.select();
            document.execCommand('copy');
            
            const copyBtn = event.target;
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'Copied!';
            setTimeout(() => {
                copyBtn.textContent = originalText;
            }, 2000);
        }
    </script>
</body>
</html>
